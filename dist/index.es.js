import{stringify as t,parse as r}from"qs";class e{constructor(t,r,e){this.name=t,this.definition=r,this.bindings=r.bindings??{},this.config={absolute:!0,...e}}get template(){return`${this.config.absolute?this.definition.domain?`${this.config.url.match(/^\w+:\/\//)[0]}${this.definition.domain}${this.config.port?":"+this.config.port:""}`:this.config.url:""}/${this.definition.uri}`}get parameterSegments(){var t;return(null===(t=this.template.match(/{[^}?]+\??}/g))||void 0===t?void 0:t.map(t=>({name:t.replace(/{|\??}/g,""),required:!/\?}$/.test(t)})))??[]}matchesUrl(t){if(!this.definition.methods.includes("GET"))return!1;const r=this.template.replace(/\/{[^}?]*\?}/g,"(/[^/?]+)?").replace(/{[^}]+}/g,"[^/?]+").replace(/^\w+:\/\//,"");return new RegExp(`^${r}$`).test(t.replace(/\/+$/,"").split("?").shift())}compile(t){return this.parameterSegments.length?this.template.replace(/{([^}?]+)\??}/g,(r,e)=>{if([null,void 0].includes(t[e])&&this.parameterSegments.find(({name:t})=>t===e).required)throw new Error(`Ziggy error: '${e}' parameter is required for route '${this.name}'.`);return encodeURIComponent(t[e]??"")}).replace(/\/+$/,""):this.template.replace(/\/+$/,"")}}class i extends String{constructor(t,r,i=!0,s){if(super(),this.t=s??Ziggy??(null===globalThis||void 0===globalThis?void 0:globalThis.Ziggy),t){if(!this.t.routes[t])throw new Error(`Ziggy error: route '${t}' is not in the route list.`);this.i=new e(t,this.t.routes[t],{...this.t,absolute:i}),this.s=this.h(r)}}toString(){const r=Object.keys(this.s).filter(t=>!this.i.parameterSegments.some(({name:r})=>r===t)).filter(t=>"_query"!==t).reduce((t,r)=>({...t,[r]:this.s[r]}),{});return this.i.compile(this.s)+t({...r,...this.s._query},{addQueryPrefix:!0,arrayFormat:"indices",encodeValuesOnly:!0,skipNulls:!0})}current(t,r){const i=window.location.host+window.location.pathname,[s,n]=Object.entries(this.t.routes).find(([r,s])=>new e(t,s,this.t).matchesUrl(i));if(!t)return s;const h=new RegExp(`^${t.replace(".","\\.").replace("*",".*")}$`).test(s);return r?(r=this.h(r,new e(s,n,this.t)),Object.entries(this.o(n)).filter(([t])=>r.hasOwnProperty(t)).every(([t,e])=>r[t]==e)):h}get params(){return this.o(this.t.routes[this.current()])}has(t){return Object.keys(this.t.routes).includes(t)}h(t={},r=this.i){t=["string","number"].includes(typeof t)?[t]:t;const e=r.parameterSegments.filter(({name:t})=>!this.t.defaults[t]);return Array.isArray(t)?t=t.reduce((t,r,i)=>({...t,[e[i].name]:r}),{}):1!==e.length||t[e[0].name]||!t.hasOwnProperty(Object.values(r.bindings)[0])&&!t.hasOwnProperty("id")||(t={[e[0].name]:t}),{...this.u(r),...this.l(t,r.bindings)}}u(t){return t.parameterSegments.filter(({name:t})=>this.t.defaults[t]).reduce((t,{name:r},e)=>({...t,[r]:this.t.defaults[r]}),{})}l(t,r={}){return Object.entries(t).reduce((t,[e,i])=>{if(!i||"object"!=typeof i||Array.isArray(i)||"_query"===e)return{...t,[e]:i};if(!i.hasOwnProperty(r[e])){if(!i.hasOwnProperty("id"))throw new Error(`Ziggy error: object passed as '${e}' parameter is missing route model binding key '${r[e]}'.`);r[e]="id"}return{...t,[e]:i[r[e]]}},{})}o(t){var e;let i=window.location.pathname.replace(this.t.url.replace(/^\w*:\/\/[^/]+/,""),"").replace(/^\/+/,"");const s=(t,r="",e)=>{const[i,s]=[t,r].map(t=>t.split(e));return s.reduce((t,r,e)=>/^{[^}?]+\??}$/.test(r)&&i[e]?{...t,[r.replace(/^{|\??}$/g,"")]:i[e]}:t,{})};return{...s(window.location.host,t.domain,"."),...s(i,t.uri,"/"),...r(null===(e=window.location.search)||void 0===e?void 0:e.replace(/^\?/,""))}}valueOf(){return this.toString()}check(t){return this.has(t)}}export default function(t,r,e,s){const n=new i(t,r,e,s);return t?n.toString():n}
//# sourceMappingURL=index.es.js.map
