!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.route=e()}(this,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function u(){return(u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(t,e,r){return(i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&s(i,r.prototype),i}).apply(null,arguments)}function l(t){var r="function"==typeof Map?new Map:void 0;return(l=function(t){if(null===t||!function(t){return-1!==Function.toString.call(t).indexOf("[native code]")}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}function e(){return i(t,arguments,c(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),s(e,t)})(t)}function f(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var h=function(){function n(t,e,r){if(a(this,n),this.name=t,this.ziggy=r,this.route=this.ziggy.namedRoutes[this.name],void 0===this.name)throw new Error("Ziggy Error: You must provide a route name");if(void 0===this.route)throw new Error("Ziggy Error: route '".concat(this.name,"' is not found in the route list"));this.absolute=void 0===e||e,this.domain=this.setDomain(),this.path=this.route.uri.replace(/^\//,"")}return t(n,[{key:"setDomain",value:function(){if(!this.absolute)return"/";if(!this.route.domain)return this.ziggy.baseUrl.replace(/\/?$/,"/");var t=(this.route.domain||this.ziggy.baseDomain).replace(/\/+$/,"");return this.ziggy.basePort&&t.replace(/\/+$/,"")===this.ziggy.baseDomain.replace(/\/+$/,"")&&(t=this.ziggy.baseDomain+":"+this.ziggy.basePort),this.ziggy.baseProtocol+"://"+t+"/"}},{key:"construct",value:function(){return this.domain+this.path}}]),n}(),o=function(){function o(t,e,r){var n,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return a(this,o),(n=f(this,c(o).call(this))).name=t,n.absolute=r,n.ziggy=i||Ziggy,n.template=n.name?new h(t,r,n.ziggy).construct():"",n.urlParams=n.normalizeParams(e),n.queryParams=n.normalizeParams(e),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(o,l(String)),t(o,[{key:"normalizeParams",value:function(t){return void 0===t?{}:(t="object"!==e(t)?[t]:t,Object.keys(t).length<1?{}:(t.hasOwnProperty("id")&&-1==this.template.indexOf("{id}")&&(t=[t.id]),this.numericParamIndices=Array.isArray(t),u({},t)))}},{key:"with",value:function(t){return this.urlParams=this.normalizeParams(t),this}},{key:"withQuery",value:function(t){return u(this.queryParams,t),this}},{key:"hydrateUrl",value:function(){var o=this,a=this.urlParams,u=0,t=this.template.match(/{([^}]+)}/gi),c=!1;return t&&t.length!=Object.keys(a).length&&(c=!0),this.template.replace(/\/{([^}]+)}/gi,function(t,e){var r=o.trimParam(e),n=o.numericParamIndices?u:r,i=o.ziggy.defaultParameters[r];if(i&&c&&(o.numericParamIndices?(a=Object.values(a)).splice(n,0,i):a[n]=i),u++,void 0!==a[n])return delete o.queryParams[n],void 0!==a[n].id?"/"+encodeURIComponent(a[n].id):"/"+encodeURIComponent(a[n]);if(-1===t.indexOf("?"))throw new Error("Ziggy Error: '".concat(r,"' key is required for route '").concat(o.name,"'"));return""})}},{key:"matchUrl",value:function(){var t=window.location.hostname+(window.location.port?":"+window.location.port:"")+window.location.pathname,e=this.template.replace(/(\/\{[^\}]*\?\})/g,"/").replace(/(\{[^\}]*\})/gi,"[^/?]+").replace(/\/?$/,"").split("://")[1],r=this.template.replace(/(\{[^\}]*\})/gi,"[^/?]+").split("://")[1],n=t.replace(/\/?$/,"/"),i=new RegExp("^"+r+"/$").test(n),o=new RegExp("^"+e+"/$").test(n);return i||o}},{key:"constructQuery",value:function(){if(0===Object.keys(this.queryParams).length)return"";var r="?";return Object.keys(this.queryParams).forEach(function(t,e){void 0!==this.queryParams[t]&&null!==this.queryParams[t]&&(r=0===e?r:r+"&",r+=t+"="+encodeURIComponent(this.queryParams[t]))}.bind(this)),r}},{key:"current",value:function(t){var e=this,r=0<arguments.length&&void 0!==t?t:null,n=Object.keys(this.ziggy.namedRoutes).filter(function(t){return-1!==e.ziggy.namedRoutes[t].methods.indexOf("GET")&&new o(t,void 0,void 0,e.ziggy).matchUrl()})[0];return r?new RegExp(r.replace("*",".*").replace(".","."),"i").test(n):n}},{key:"extractParams",value:function(t,e,r){var n=this,i=t.split(r);return e.split(r).reduce(function(t,e,r){return 0===e.indexOf("{")&&-1!==e.indexOf("}")&&i[r]?u(t,function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}({},n.trimParam(e),i[r])):t},{})}},{key:"parse",value:function(){this.return=this.hydrateUrl()+this.constructQuery()}},{key:"url",value:function(){return this.parse(),this.return}},{key:"toString",value:function(){return this.url()}},{key:"trimParam",value:function(t){return t.replace(/{|}|\?/g,"")}},{key:"valueOf",value:function(){return this.url()}},{key:"params",get:function(){var t=this.ziggy.namedRoutes[this.current()];return u(this.extractParams(window.location.hostname,t.domain||"","."),this.extractParams(window.location.pathname.slice(1),t.uri,"/"))}}]),o}();return function(t,e,r,n){return new o(t,e,r,n)}});
